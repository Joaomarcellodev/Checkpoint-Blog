<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="imagem/x-icon" href="./src/assets/favicon.png" />
    <link rel="stylesheet" href="./src/output.css" />
    <title>Cadastro de games</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-orange-200 min-h-screen flex flex-col">
    <header class="bg-gray-900">
      <div class="flex justify-center items-center">
        <img
          class="h-60"
          src="src/assets/logo.png"
          alt="Logo Checkpoint Blog"
        />
      </div>
    </header>

    <nav class="bg-gray-300 px-2 text-gray-700 flex space-x-3 justify-center">
      <a
        class="py-2 px-1 hover:bg-orange-300 hover:text-white hover:font-bold"
        href="index.html"
        >Inicio</a
      >
      <a
        class="py-2 px-1 hover:bg-orange-300 hover:text-white hover:font-bold"
        href="sobre.html"
        >Sobre</a
      >
      <a
        class="py-2 px-1 hover:bg-orange-300 hover:text-white hover:font-bold"
        href="maisjogados.html"
        >Mais Jogados</a
      >
      <a
        class="py-2 px-1 hover:bg-orange-300 hover:text-white hover:font-bold"
        href="contato.html"
        >Contato</a
      >
      <a
        class="py-2 px-1 hover:bg-orange-300 hover:text-white hover:font-bold"
        href="dashboard.html"
        >Dashboard</a
      >
    </nav>

    <main
      class="flex-grow container mx-auto p-4 flex items-center justify-center"
    >
      <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
          Adicionar Novo Jogo
        </h1>

        <form id="gameForm" class="space-y-4">
          <div>
            <label
              for="title"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Título do Jogo:</label
            >
            <input
              type="text"
              id="title"
              name="title"
              required
              placeholder="Digite o nome do Jogo"
              class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-orange-500"
            />
          </div>

          <div>
            <label
              for="subtitle"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Plataforma que desenvolveu:</label
            >
            <input
              type="text"
              id="subtitle"
              name="subtitle"
              placeholder="Digite a empresa que desenvolveu"
              class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-orange-500"
            />
          </div>

          <div>
            <label
              for="imageUrl"
              class="block text-gray-700 text-sm font-bold mb-2"
              >URL da Imagem:</label
            >
            <input
              type="url"
              id="imageUrl"
              name="imageUrl"
              required
              placeholder="Coloque o link da imagem"
              class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-orange-500"
            />
          </div>

          <div>
            <label
              for="description"
              class="block text-gray-700 text-sm font-bold mb-2"
              >Descrição:</label
            >
            <textarea
              id="description"
              name="description"
              rows="6"
              required
              placeholder="Coloque uma breve descrição sobre o jogo"
              class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-orange-500"
            ></textarea>
          </div>

          <div>
            <label
              for="destinationUrl"
              class="block text-gray-700 text-sm font-bold mb-2"
              >URL da Página de Destino (Opcional para Outras Indicações):</label
            >
            <input
              type="url"
              id="destinationUrl"
              name="destinationUrl"
              placeholder="Ex: https://seublog.com/detalhes-do-jogo"
              class="shadow appearance-none border rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-orange-500"
            />
          </div>

          <div>
            <label class="block text-gray-700 text-sm font-bold mb-2"
              >Onde exibir o jogo?</label
            >
            <div class="mt-2 space-y-2">
              <label class="inline-flex items-center">
                <input
                  type="radio"
                  class="form-radio text-orange-600 rounded-full"
                  name="placement"
                  value="index"
                  checked
                />
                <span class="ml-2 text-gray-700">Página Inicial</span>
              </label>
              <label class="inline-flex items-center ml-4">
                <input
                  type="radio"
                  class="form-radio text-orange-600 rounded-full"
                  name="placement"
                  value="maisjogados"
                />
                <span class="ml-2 text-gray-700">Mais Jogados</span>
              </label>
              <label class="inline-flex items-center ml-4">
                <input
                  type="radio"
                  class="form-radio text-orange-600 rounded-full"
                  name="placement"
                  value="outras_indicacoes"
                />
                <span class="ml-2 text-gray-700">Outras Indicações</span>
              </label>
            </div>
          </div>

          <button
            type="submit"
            class="bg-orange-500 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline w-full transition duration-300 ease-in-out transform hover:scale-105"
          >
            Adicionar Jogo
          </button>

          <div
            id="statusMessage"
            class="text-center mt-4 text-sm font-semibold"
          ></div>
        </form>
      </div>
    </main>

    <footer
      class="bg-orange-500 w-full h-24 items-center justify-center flex text-center"
    >
      <div class="text-center text-sm">
        <p class="text-white">
          &copy; 2025 CheckPoint Blog. Todos os direitos reservados -
          Desenvolvido por
          <a
            class="hover:text-gray-700 hover:underline"
            href="https://joaomarcello.vercel.app/"
            >Joaomarcello.dev</a
          >
        </p>
      </div>
    </footer>

    <script type="module">
      // Importe as funções necessárias do Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithCustomToken,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // SUA CONFIGURAÇÃO DO FIREBASE (USE A SUA REAL!)
      const firebaseConfig = {
        apiKey: "AIzaSyBKt0S9F5DeZxZOPnLMx3x8VQJBx9Zbn-E",
        authDomain: "checkpoint-blog-781dd.firebaseapp.com",
        projectId: "checkpoint-blog-781dd",
        storageBucket: "checkpoint-blog-781dd.firebasestorage.app",
        messagingSenderId: "719291913960",
        appId: "1:719291913960:web:a222f2ad700d773c359b5d",
      };

      // Inicializa o Firebase
      const appId = firebaseConfig.appId;

      let app;
      let db;
      let auth;
      let userId;

      /**
       * Inicializa o Firebase e autentica o usuário.
       */
      async function initializeFirebase() {
        try {
          app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          auth = getAuth(app);

          if (typeof __initial_auth_token !== "undefined") {
            await signInWithCustomToken(auth, __initial_auth_token);
          } else {
            await signInAnonymously(auth);
          }
          userId = auth.currentUser?.uid || crypto.randomUUID();
          console.log("Firebase inicializado e usuário autenticado:", userId);
        } catch (error) {
          console.error("Erro ao inicializar o Firebase ou autenticar:", error);
          document.getElementById("statusMessage").textContent =
            "Erro ao inicializar o Firebase. Verifique o console.";
          document
            .getElementById("statusMessage")
            .classList.add("text-red-500");
        }
      }

      document.addEventListener("DOMContentLoaded", initializeFirebase);

      document
        .getElementById("gameForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          if (!db) {
            console.error("Firestore não inicializado.");
            document.getElementById("statusMessage").textContent =
              "Erro: Firestore não inicializado. Tente novamente.";
            document
              .getElementById("statusMessage")
              .classList.add("text-red-500");
            return;
          }

          const title = document.getElementById("title").value;
          const subtitle = document.getElementById("subtitle").value;
          const imageUrl = document.getElementById("imageUrl").value;
          const description = document.getElementById("description").value;
          // Capture o novo campo destinationUrl
          const destinationUrl = document.getElementById("destinationUrl").value;
          const placement = document.querySelector(
            'input[name="placement"]:checked'
          ).value;

          const statusMessage = document.getElementById("statusMessage");
          statusMessage.textContent = "Enviando...";
          statusMessage.classList.remove("text-red-500", "text-green-500");
          statusMessage.classList.add("text-blue-500");

          try {
            let gameData = {
              placement,
              imageUrl,
              createdAt: new Date(),
              // Adiciona o destinationUrl ao gameData.
              // Ele será salvo como string vazia se não preenchido.
              destinationUrl: destinationUrl || '', // Salva como string vazia se o campo estiver vazio
            };

            if (placement === "maisjogados") {
              gameData.title = title || "";
              gameData.subtitle = subtitle || "";
              gameData.description = description || "";
              // Para "Mais Jogados", a URL de destino é opcional
            } else if (placement === "outras_indicacoes") {
              gameData.title = title || ""; // Opcional para alt text
              gameData.subtitle = subtitle || ""; // Opcional
              gameData.description = description || ""; // Opcional

              // VALIDAÇÃO ESPECÍFICA: Se for "Outras Indicações", a URL de destino é obrigatória.
              if (!gameData.destinationUrl) {
                statusMessage.textContent = "Para 'Outras Indicações', por favor, forneça uma URL de Página de Destino.";
                statusMessage.classList.remove("text-blue-500", "text-green-500");
                statusMessage.classList.add("text-red-500");
                return; // Impede o envio se faltarem campos
              }
            } else { // placement === 'index'
              gameData.title = title;
              gameData.subtitle = subtitle;
              gameData.description = description;

              if (
                !gameData.title ||
                !gameData.subtitle ||
                !gameData.description ||
                !gameData.imageUrl
              ) {
                statusMessage.textContent =
                  "Por favor, preencha Título, Plataforma, Descrição e URL da Imagem para a Página Inicial.";
                statusMessage.classList.remove(
                  "text-blue-500",
                  "text-green-500"
                );
                statusMessage.classList.add("text-red-500");
                return;
              }
              // Para "Página Inicial", a URL de destino também é opcional.
            }

            const collectionPath = `artifacts/${appId}/public/data/games`;
            await addDoc(collection(db, collectionPath), gameData);

            statusMessage.textContent = "Jogo adicionado com sucesso!";
            statusMessage.classList.remove("text-blue-500");
            statusMessage.classList.add("text-green-500");
            document.getElementById("gameForm").reset();
          } catch (e) {
            console.error("Erro ao adicionar documento: ", e);
            statusMessage.textContent =
              "Erro ao adicionar o jogo: " + e.message;
            statusMessage.classList.remove("text-blue-500", "text-green-500");
            statusMessage.classList.add("text-red-500");
          }
        });
    </script>
  </body>
</html>